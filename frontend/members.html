<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Members - GymSync Pro</title>
<link rel="stylesheet" href="global.css">

<style>
.card{
background:rgba(0,0,0,0.6);
padding:20px;
border-radius:14px;
backdrop-filter:blur(8px);
}

table{
width:100%;
border-collapse:collapse;
margin-top:10px;
}

th,td{
padding:12px;
text-align:center;
}

th{
color:#00eaff;
font-size:15px;
}

tr{
border-bottom:1px solid rgba(255,255,255,0.1);
}

button{
padding:6px 12px;
border:none;
border-radius:8px;
cursor:pointer;
font-weight:bold;
}

.renew-btn{
background:linear-gradient(45deg,#00eaff,#7b2cff);
color:white;
}

.trainer-select{
background:#0f172a;
color:#00eaff;
border:1px solid #00eaff;
padding:6px;
border-radius:8px;
}
</style>
</head>

<body>

<div class="sidebar">
<h2>GYMSYNC PRO</h2>

<a href="dashboard.html" class="nav-link">Dashboard</a>
<a href="members.html" class="nav-link">Members</a>
<a href="trainers.html" class="nav-link">Trainers</a>
<a href="attendance.html" class="nav-link">Attendance</a>
<a href="payments.html" class="nav-link">Payments</a>
<a href="reports.html" class="nav-link">Reports</a>
<a href="../backend/logout.php">Logout</a>
</div>

<div class="main">
<h1>Members Management</h1>

<div class="card">
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Phone</th>
<th>Email</th>
<th>Plan</th>
<th>Status</th>
<th>Expiry</th>
<th>Assign Trainer</th>
<th>Action</th>
</tr>
</thead>

<tbody id="membersTable"></tbody>
</table>
</div>
</div>

<script>

let trainersList=[];

/* LOAD TRAINERS */
function loadTrainers(){
return fetch("../backend/get_trainers.php")
.then(res=>res.json())
.then(data=>{
trainersList=data;
});
}

/* LOAD MEMBERS */
function loadMembers(){
fetch("../backend/get_members.php")
.then(res=>res.json())
.then(data=>{

let rows="";

data.forEach(m=>{

let trainerOptions='<option value="">Select</option>';

trainersList.forEach(t=>{
trainerOptions+=`<option value="${t.id}">${t.name}</option>`;
});

rows+=`
<tr>
<td>${m.id}</td>
<td>${m.name}</td>
<td>${m.phone}</td>
<td>${m.email}</td>
<td>${m.membership_plan ?? "-"}</td>
<td>${m.status ?? "-"}</td>
<td>${m.expiry_date ?? "-"}</td>

<td>
<select class="trainer-select" onchange="assignTrainer(${m.id}, this.value)">
${trainerOptions}
</select>
</td>

<td>
<button class="renew-btn" onclick="renewMember(${m.id})">Renew</button>
</td>
</tr>
`;

});

document.getElementById("membersTable").innerHTML=rows;

});
}

/* ASSIGN TRAINER */
function assignTrainer(memberId, trainerId){

if(trainerId=="") return;

fetch("../backend/assign_trainer.php",{
method:"POST",
headers:{"Content-Type":"application/x-www-form-urlencoded"},
body:`member_id=${memberId}&trainer_id=${trainerId}`
})
.then(res=>res.text())
.then(()=>{
alert("Trainer Assigned Successfully");
});
}

/* RENEW */
function renewMember(id){

let plan = prompt("Enter plan (1/3/6 months)");

if(!plan) return;

fetch("../backend/renew_membership.php",{
method:"POST",
headers:{"Content-Type":"application/x-www-form-urlencoded"},
body:"member_id="+id+"&plan="+plan
})
.then(res=>res.text())
.then(()=>{
alert("Membership Renewed");
location.reload();
});
}

/* INIT */
loadTrainers().then(loadMembers);

/* ACTIVE LINK */
const links = document.querySelectorAll(".nav-link");
const current = window.location.pathname.split("/").pop();
links.forEach(link=>{
if(link.getAttribute("href")===current){
link.style.color="#00eaff";
link.style.fontWeight="bold";
}
});
</script>

</body>
</html>