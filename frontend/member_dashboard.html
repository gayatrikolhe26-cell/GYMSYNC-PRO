<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Member Dashboard</title>
<link rel="stylesheet" href="global.css">
</head>

<body>

<div class="sidebar">
<h2>MEMBER PANEL</h2>

<a href="member_dashboard.html">Dashboard</a>
<a href="member_progress.html">My Progress</a>
<a href="member_classes.html">My Classes</a>
<a href="member_profile.html">My Card</a>

<a href="../backend/logout.php">Logout</a>
</div>
<div class="content">

<h1>Welcome to GymSync</h1>
<h2 id="welcomeName"></h2>

<!-- TOP STATS -->
<div class="dashboard-grid">

<div class="stat-card">
<h3>Membership Plan</h3>
<p id="plan">-</p>
</div>

<div class="stat-card">
<h3>Expiry Date</h3>
<p id="expiry">-</p>
</div>

<div class="stat-card">
<h3>Status</h3>
<p id="status">-</p>
</div>

<div class="stat-card">
<h3>BMI</h3>
<p id="bmi">-</p>
</div>

<div class="stat-card">
<h3>Trainer</h3>
<p id="trainer">-</p>
</div>

<div class="stat-card">
<h3>Total Attendance</h3>
<p id="attendance">0</p>
</div>

</div>

<!-- UPCOMING CLASSES -->
<h2 class="section-title">Upcoming Classes</h2>
<div id="classes" class="card-section"></div>

<!-- PAYMENT HISTORY -->
<h2 class="section-title">Payment History</h2>
<div class="table-container">
<table>
<thead>
<tr><th>Amount</th><th>Date</th></tr>
</thead>
<tbody id="paymentTable"></tbody>
</table>
</div>

<!-- PROGRESS -->
<h2 class="section-title">Health Progress</h2>
<div class="table-container">
<table>
<thead>
<tr><th>Weight</th><th>BMI</th><th>Date</th></tr>
</thead>
<tbody id="progressTable"></tbody>
</table>

</div>

</div>

<script>
// MEMBER DATA
fetch("../backend/member_dashboard.php")
.then(res=>res.json())
.then(d=>{

document.getElementById("welcomeName").innerText="Welcome, "+d.name;

document.getElementById("plan").innerText=d.plan ?? "-";
document.getElementById("expiry").innerText=d.expiry ?? "-";
document.getElementById("status").innerText=d.status ?? "-";
document.getElementById("bmi").innerText=d.bmi ?? "-";
document.getElementById("trainer").innerText=d.trainer ?? "-";
document.getElementById("attendance").innerText=d.attendance ?? 0;

// payments
let pay="";
d.payments.forEach(p=>{
pay+=`<tr><td>â‚¹ ${p.amount}</td><td>${p.payment_date}</td></tr>`;
});
document.getElementById("paymentTable").innerHTML=pay;

});

// PROGRESS
fetch("../backend/member_progress.php")
.then(res=>res.json())
.then(data=>{
let rows="";
data.forEach(p=>{
rows+=`<tr>
<td>${p.weight} kg</td>
<td>${parseFloat(p.bmi).toFixed(1)}</td>
<td>${p.date}</td>
</tr>`;
});
document.getElementById("progressTable").innerHTML=rows;
});

// CLASSES
fetch("../backend/get_member_schedule.php")
.then(r=>r.json())
.then(data=>{

let html="";
if(data.length==0){ html="<p>No classes scheduled</p>"; }

data.forEach(c=>{
html+=`
<div style="
background:rgba(0,0,0,0.6);
padding:15px;
border-radius:12px;
width:230px;
box-shadow:0 0 15px cyan;
">
<h3>${c.workout}</h3>
<p>${c.class_date}</p>
<p>${c.class_time}</p>
</div>`;
});

document.getElementById("classes").innerHTML=html;

});
</script>
</body>
</html>